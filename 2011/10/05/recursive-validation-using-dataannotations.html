<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <title>Recursive Validation Using DataAnnotations - Techno Fattie</title>

    <!-- Fonts -->
    <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro%3A400%2C400italic%2C700" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Varela+Round" rel="stylesheet">

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/font-awesome.min.css" rel="stylesheet">
    <link href="/css/bootstrap-social.css" rel="stylesheet">

    <!-- Styles -->
    <link href="/css/main.css" rel="stylesheet">
    <link href="/css/pygments/vs.css" rel="stylesheet">

    <!-- Loading bar -->
    <script src="/js/pace.min.js"></script>

    <!-- HTML5 shiv for IE8 support -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div id="secondary" class="col-sm-3 sidebar" style="display: none;">
      <aside>

        <div class="about">
          <h4>About Josh Carroll</h4>
          <p>Computer geek, husband, father, theologian. I rock out web sites. I work for <a href="http://www.wintellect.com/">Wintellect</a>.</p>
        </div>

        <div class="socialmedia">
          <h4>Connect</h4>
          <div class="socials-sidebar">
          
            <a class="btn btn-twitter" href="https://twitter.com/jwcarroll" title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          
            <a class="btn btn-linkedin" href="https://www.linkedin.com/in/jwcarroll" title="LinkedIn">
              <i class="fa fa-linkedin"></i>
            </a>
          
            <a class="btn btn-google-plus" href="https://www.google.com/+JoshCarrollW" title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          
            <a class="btn btn-github" href="https://github.com/jwcarroll" title="GitHub">
              <i class="fa fa-github"></i>
            </a>
          
          </div> <!-- /.socials-sidebar -->
        </div>
        
        <div class="tags">
          <h4>Tags</h4>
          <ul>
          
            <li>
              <a href="/tags/f%23.html" class="tag btn btn-tag btn-sm">f#</a>
            </li>
          
            <li>
              <a href="/tags/.net.html" class="tag btn btn-tag btn-sm">.net</a>
            </li>
          
            <li>
              <a href="/tags/c%23.html" class="tag btn btn-tag btn-sm">c#</a>
            </li>
          
            <li>
              <a href="/tags/data-sets.html" class="tag btn btn-tag btn-sm">data-sets</a>
            </li>
          
            <li>
              <a href="/tags/commentary.html" class="tag btn btn-tag btn-sm">commentary</a>
            </li>
          
            <li>
              <a href="/tags/qa.html" class="tag btn btn-tag btn-sm">qa</a>
            </li>
          
            <li>
              <a href="/tags/tdd.html" class="tag btn btn-tag btn-sm">tdd</a>
            </li>
          
            <li>
              <a href="/tags/unit-testing.html" class="tag btn btn-tag btn-sm">unit-testing</a>
            </li>
          
            <li>
              <a href="/tags/security.html" class="tag btn btn-tag btn-sm">security</a>
            </li>
          
            <li>
              <a href="/tags/wpf.html" class="tag btn btn-tag btn-sm">wpf</a>
            </li>
          
            <li>
              <a href="/tags/validation.html" class="tag btn btn-tag btn-sm">validation</a>
            </li>
          
            <li>
              <a href="/tags/programming.html" class="tag btn btn-tag btn-sm">programming</a>
            </li>
          
            <li>
              <a href="/tags/sarcasm.html" class="tag btn btn-tag btn-sm">sarcasm</a>
            </li>
          
            <li>
              <a href="/tags/stackoverflow.html" class="tag btn btn-tag btn-sm">stackoverflow</a>
            </li>
          
            <li>
              <a href="/tags/dynamic.html" class="tag btn btn-tag btn-sm">dynamic</a>
            </li>
          
            <li>
              <a href="/tags/powershell.html" class="tag btn btn-tag btn-sm">powershell</a>
            </li>
          
            <li>
              <a href="/tags/angular.html" class="tag btn btn-tag btn-sm">angular</a>
            </li>
          
            <li>
              <a href="/tags/dependency-injection.html" class="tag btn btn-tag btn-sm">dependency-injection</a>
            </li>
          
            <li>
              <a href="/tags/humor.html" class="tag btn btn-tag btn-sm">humor</a>
            </li>
          
          </ul>
        </div>
        
        <div class="sidebar-links">
         <h4><a href="/archives/">Archives</a></h4>
        </div>
        
        
        <div>
            <h4>You Might Also Like:</h4>
            
            <h5>
               <a href="/2011/09/23/solving-ayende%27s-tax-woes.html">Solving Ayende's Tax Woes</a>
            </h5>
            
            <h5>
               <a href="/2011/02/11/wpf-fancy-winforms.html">WPF != Fancy Winforms</a>
            </h5>
            
            <h5>
               <a href="/2012/08/31/prototypal-inheritance-in-c%23.html">Prototypal Inheritance in C#</a>
            </h5>
            
            <h5>
               <a href="/2010/06/25/extending-moq-using-extension-methods.html">Extending Moq Using Extension Methods</a>
            </h5>
            
            <h5>
               <a href="/2011/02/09/unit-testing-and-declarative-security-part-1.html">Unit Testing and Declarative Security, Part 1</a>
            </h5>
            
        </div>
        
        
      </aside>
    </div> <!-- /#secondary -->

    <div id="primary" class="col-sm-12">
      <div class="content">
        
        <header class="header">
          <hgroup class="pull-left">
            <h1 class="site-title">
              <a rel="home" title="Techno Fattie" href="/">
                <i class="fa fa-code"></i> Techno Fattie
              </a>
            </h1>            
          </hgroup>
          <div id="togglesidebar" class="btn btn-primary pull-right">
            <i class="fa fa-bars"></i>
          </div>
        </header> <!-- /header -->

        

<section class="post">
 <header class="entry-header">
   <img class="entry-avatar" alt="Josh Carroll" height="52" width="52" src="http://www.gravatar.com/avatar/213ff080fa03648f0b71e4f4658a8046.png?s=52">
   <h1 class="entry-title"><a href="/2011/10/05/recursive-validation-using-dataannotations.html">Recursive Validation Using DataAnnotations</a></h1>
   <p class="entry-meta">
     Posted on <a class="entry-date" href="/archives/#october-2011">05 October 2011</a> | 
     By <a class="entry-author" href="/about/">Josh Carroll</a>
     
     | Tags 
     
     <a href="/tags/c%23.html" class="btn btn-default btn-xs">c#</a> 
     
     <a href="/tags/.net.html" class="btn btn-default btn-xs">.net</a> 
     
     <a href="/tags/validation.html" class="btn btn-default btn-xs">validation</a> 
     
     
   </p>
 </header>
 <div class="entry-description">
   I saw a <a href="http://stackoverflow.com/questions/7663501/dataannotations-recursively-validating-an-entire-object-graph">post on Stackoverflow</a> today that piqued my interest.<br /><br />The title really says it all:<br /><br /><span class="Apple-style-span" style="background-color: white; font-family: 'Trebuchet MS', 'Liberation Sans', 'DejaVu Sans', sans-serif; line-height: 12px;"></span><br /><h1 style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; font-family: 'Trebuchet MS', 'Liberation Sans', 'DejaVu Sans', sans-serif; font-weight: bold; margin-bottom: 7px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;"> <span class="Apple-style-span" style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; color: black; cursor: pointer; font-size: small; font-weight: bold; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-decoration: none; vertical-align: baseline;"><a class="question-hyperlink" href="http://stackoverflow.com/questions/7663501/dataannotations-recursively-validating-an-entire-object-graph" style="background-attachment: initial; background-clip: initial; background-color: transparent; background-image: initial; background-origin: initial; border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; color: black; cursor: pointer; font-weight: bold; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-decoration: none; vertical-align: baseline;">DataAnnotations: Recursively validating an entire object graph</a></span></h1><br />Using the DataAnnotations to do validation on object can be extermely useful, but there are many limitations to the existing code base. One such limitations, as <a href="http://stackoverflow.com/users/26414/neil-barnwell">Neil </a>has discovered, is that the out of the box validator doesn't recursively apply validation.<br /><br />Indeed looking at the MSDN docs for <a href="http://msdn.microsoft.com/en-us/library/dd411772.aspx">TryValidateObject</a> state clearly that:<br /><blockquote><span class="Apple-style-span" style="font-family: 'Segoe UI', Verdana, Arial; font-size: 13px;">This method evaluates each&nbsp;<a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.validationattribute.aspx" style="color: #1364c4; text-decoration: none;">ValidationAttribute</a>&nbsp;instance that is attached to the object type. It also checks whether each property that is marked with&nbsp;<a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.requiredattribute.aspx" style="color: #1364c4; text-decoration: none;">RequiredAttribute</a>&nbsp;is provided.<span class="Apple-style-span" style="background-color: yellow;"> It does not recursively validate</span> the property values of the object.</span></blockquote>&nbsp;So how do we get around this? Well... there are several examples of people using reflection and LINQ to recurse over the individual properties and validate each one of them. Yuck!<br /><br /><b>I'm a big fan of working with the framework</b> if at all possible, so I decided to implement a quick solution that fits nicely into the DataAnnotations world.<br /><br />The idea is to simply tell the validation framework that you would like to do a little extra with some particular property. I want to be able to be able to <i>opt in</i> certain properties to further validation if necessary. Something like this.<br /><br /><pre><code>public class Person {<br />  [Required]<br />  public String Name { get; set; }<br /><br />  [Required, ValidateObject]<br />  public Address Address { get; set; }<br />}</code></pre><br />Address could have it's own set of validation attributes, and I want to also validate those along with my Person type. <b>Turns out this is pretty simple to do using existing framework components.</b><br /><b><br /></b><br />Let me just show you the code, and then I can explain what is going on. <br /><br /><pre><code>public class ValidateObjectAttribute: ValidationAttribute {<br />   protected override ValidationResult IsValid(object value, ValidationContext validationContext) {<br />      var results = new List&lt;ValidationResult&gt;();<br />      var context = new ValidationContext(value, null, null);<br />         <br />      Validator.TryValidateObject(value, context, results, true);<br /><br />      if (results.Count != 0) {<br />         var compositeResults = new CompositeValidationResult(String.Format("Validation for {0} failed!", validationContext.DisplayName));<br />         results.ForEach(compositeResults.AddResult);<br /><br />         return compositeResults;<br />      }<br /><br />      return ValidationResult.Success;<br />   }<br />}<br /><br />public class CompositeValidationResult: ValidationResult {<br />   private readonly List&lt;ValidationResult&gt; _results = new List&lt;ValidationResult&gt;();<br /><br />   public IEnumerable&lt;ValidationResult&gt; Results {<br />      get {<br />         return _results;<br />      }<br />   }<br /><br />   public CompositeValidationResult(string errorMessage) : base(errorMessage) {}<br />   public CompositeValidationResult(string errorMessage, IEnumerable&lt;string&gt; memberNames) : base(errorMessage, memberNames) {}<br />   protected CompositeValidationResult(ValidationResult validationResult) : base(validationResult) {}<br /><br />   public void AddResult(ValidationResult validationResult) {<br />      _results.Add(validationResult);<br />   }<br />}<br /></string></code></pre><br /><br />The idea here is pretty simple. Any property decorated with the ValidateObjectAttribute will be validated as a whole, and the results aggregated together. The processing is as follows: <br /><br /><ol><li>Create a new ValidationContext using the current value as the target</li><li>Attempt to validate that object, being sure to include all properties</li><li>If there are any ValidationResults, store them and return as a single aggregate failure</li><li>If there are no results, return ValidationResults.Success</li></ol><div>Putting it all together, imagine for a minute that we had the following class structure:</div><div><br /></div><pre><code>public class Person {<br />  [Required]<br />  public String Name { get; set; }<br /><br />  [Required, ValidateObject]<br />  public Address Address { get; set; }<br />}<br /><br />public class Address {<br />  [Required]<br />  public String Street1 { get; set; }<br /><br />  public String Street2 { get; set; }<br /><br />  [Required]<br />  public String City { get; set; }<br /><br />  [Required]<br />  public String State { get; set; }<br /><br />  [Required, ValidateObject]<br />  public ZipCode Zip { get; set; }<br />}<br /><br />public class ZipCode {<br />  [Required]<br />  public String PrimaryCode { get; set; }<br /><br />  public String SubCode { get; set; }<br />}<br /></code><br /></pre><br />We can simply make use of existing methods and validate the entire object graph. Also, making use of our CompositeValidationResult, we should be able to drill into each individual failure in context.<br /><br /><br /><pre><code>static void Main(string[] args) {<br />   var person = new Person {<br />      Address = new Address {<br />         City = "Awesome Town",<br />         State = "TN",<br />         Zip = new ZipCode()<br />      },<br />      Name = "Josh"<br />   };<br /><br />   var context = new ValidationContext(person, null, null);<br />   var results = new List&lt;ValidationResult&gt;();<br /><br />   Validator.TryValidateObject(person, context, results, true);<br /><br />   PrintResults(results, 0);<br /><br />   Console.ReadKey();<br />}<br /><br />private static void PrintResults(IEnumerable&lt;ValidationResult&gt; results, Int32 indentationLevel) {<br />   foreach (var validationResult in results) {<br />      SetIndentation(indentationLevel);<br /><br />      Console.WriteLine(validationResult.ErrorMessage);<br />      Console.WriteLine();<br /><br />      if (validationResult is CompositeValidationResult) {<br />         PrintResults(((CompositeValidationResult)validationResult).Results, indentationLevel + 1);<br />      }<br />   }<br />}<br /><br />private static void SetIndentation(int indentationLevel) {<br />   Console.CursorLeft = indentationLevel * 4;<br />}<br /></code><br /></pre><br />Running the above should result in the following output: <br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-mJLDCk0nY4Y/Toycmc6xuWI/AAAAAAAABF8/M99mCHMfxWs/s1600/RecursiveValidation.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="163" src="http://1.bp.blogspot.com/-mJLDCk0nY4Y/Toycmc6xuWI/AAAAAAAABF8/M99mCHMfxWs/s400/RecursiveValidation.png" width="366" /></a></div><br /><br />Well, there you have it. A pretty simple solution that has the advantage of working alongside the Validation framework instead of against it!

 </div>
 

<div class="footer">
    <h4>Share This Post</h4>

    <div class="socials-footer">
        <a class="btn btn-twitter" href="http://twitter.com/share?text=Recursive Validation Using DataAnnotations by @jwcarroll&url=http://www.technofattie.com/2011/10/05/recursive-validation-using-dataannotations.html"
           onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
            <i class="fa fa-twitter"></i>
        </a>
        <a class="btn btn-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://www.technofattie.com/2011/10/05/recursive-validation-using-dataannotations.html"
           onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
            <i class="fa fa-facebook"></i>
        </a>
        <a class="btn btn-google-plus" href="https://plus.google.com/share?url=http://www.technofattie.com/2011/10/05/recursive-validation-using-dataannotations.html"
           onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
            <i class="fa fa-google-plus"></i>
        </a>
    </div>
</div>
</section>

<div class="comments">
 <div id="disqus_thread"></div>
 <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'technofattie'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
 </script>
 <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
 <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

        <footer class="footer">
          <p>© <a href="/about/">Josh Carroll</a> 2014. All right reserved.</p>
          <div class="socials-footer">
          
            <a class="btn btn-twitter" href="https://twitter.com/jwcarroll" title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          
            <a class="btn btn-linkedin" href="https://www.linkedin.com/in/jwcarroll" title="LinkedIn">
              <i class="fa fa-linkedin"></i>
            </a>
          
            <a class="btn btn-google-plus" href="https://www.google.com/+JoshCarrollW" title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          
            <a class="btn btn-github" href="https://github.com/jwcarroll" title="GitHub">
              <i class="fa fa-github"></i>
            </a>
          
          </div> <!-- /.socials-footer -->
        </footer> <!-- /footer -->

      </div>
    </div> <!-- /#primary -->

    <!-- Scripts -->
    <script src="/js/jquery-1.11.0.min.js"></script>
    <script src="/js/custom.js"></script>

  </body>
</html>